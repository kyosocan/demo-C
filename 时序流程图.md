# 家长社区应用 - 时序流程图

## 1. 整体应用架构流程

```mermaid
flowchart TB
    subgraph 入口
        A[App.tsx 主入口]
    end
    
    subgraph 主页面
        B[广场页面 Plaza]
        C[资料页面 Material]
        D[答疑页面 QA]
        E[学习集页面 StudySet]
        F[名师页面 Teacher]
    end
    
    subgraph 详情页面
        G[资料详情 MaterialDetail]
        H[问答详情 QuestionDetail]
        I[学习集详情 StudySetDetail]
        J[名师详情 TeacherDetailPage]
    end
    
    subgraph 用户中心
        K[个人资料页 ProfilePage]
        L[消息中心 MessageCenter]
        M[他人主页]
    end
    
    subgraph 创建流程
        N[发帖操作抽屉]
        O[写想法页面]
        P[选择配图页面]
        Q[编辑帖子页面]
    end
    
    subgraph 功能组件
        R[搜索模态框]
        S[筛选抽屉]
        T[创建资料模态框]
        U[创建学习集模态框]
        V[提问模态框]
    end
    
    A --> B
    B --> C & D & E & F
    B --> G & H & I
    C --> G
    D --> H
    E --> I
    F --> J
    
    B --> K & L
    G & H & I --> M
    
    B --> N --> O --> P --> Q
    B --> R & S
    C --> T
    E --> U
    D --> V
```

---

## 2. 用户浏览内容流程

```mermaid
sequenceDiagram
    participant U as 用户
    participant App as App.tsx
    participant Header as PlazaHeader
    participant Card as PlazaContentCard
    participant Detail as 详情页面
    participant Mock as mockData

    U->>App: 打开应用
    App->>Mock: 加载 mockContents
    Mock-->>App: 返回内容列表
    App->>Header: 渲染头部导航
    App->>Card: 渲染内容卡片列表
    
    U->>Header: 切换标签页(资料/答疑/学习集/名师)
    Header->>App: setCurrentTab()
    App->>App: 根据类型筛选内容
    App->>Card: 重新渲染对应内容
    
    U->>Card: 点击内容卡片
    Card->>App: onClick 回调
    App->>App: setSelectedMaterial/Question/StudySet
    App->>Detail: 渲染详情页面
    
    U->>Detail: 点击返回
    Detail->>App: onBack 回调
    App->>App: 清空 selected 状态
    App->>Card: 返回列表页面
```

---

## 3. 发帖创建流程

```mermaid
sequenceDiagram
    participant U as 用户
    participant FAB as 悬浮按钮
    participant Sheet as PostActionSheet
    participant Write as WriteIdeaPage
    participant Select as SelectIllustrationPage
    participant Edit as EditPostPage
    participant App as App.tsx

    U->>FAB: 点击红色加号按钮
    FAB->>App: setShowPostActionSheet(true)
    App->>Sheet: 显示操作抽屉
    
    alt 从相册选择
        U->>Sheet: 点击"从相册选择"
        Sheet->>App: onSelectFromAlbum()
        Note right of App: 调用系统相册
    else 打开相机
        U->>Sheet: 点击"打开相机"
        Sheet->>App: onCamera()
        Note right of App: 调用系统相机
    else 写想法
        U->>Sheet: 点击"写想法"
        Sheet->>App: setShowWriteIdeaPage(true)
        App->>Write: 显示写想法页面
        
        U->>Write: 输入文字内容
        U->>Write: 点击"下一步"
        Write->>App: onNext(text)
        App->>App: setPostText(text)
        App->>Select: 显示选择配图页面
        
        U->>Select: 选择配图
        U->>Select: 点击"下一步"
        Select->>App: onNext(card)
        App->>Edit: 显示编辑帖子页面
        
        U->>Edit: 编辑标题、正文、添加文件夹
        alt 发布笔记
            U->>Edit: 点击"发布笔记"
            Edit->>App: onPublish(data)
            App->>App: 更新 contents 状态
            Note right of App: 帖子发布成功
        else 存草稿
            U->>Edit: 点击"存草稿"
            Edit->>App: onSaveDraft()
            Note right of App: 保存到草稿箱
        end
    end
```

---

## 4. 搜索与筛选流程

```mermaid
sequenceDiagram
    participant U as 用户
    participant Header as PlazaHeader
    participant Search as SearchModal
    participant Filter as FilterDrawer
    participant App as App.tsx
    participant List as 内容列表

    rect rgb(240, 248, 255)
        Note over U, List: 搜索流程
        U->>Header: 点击搜索图标
        Header->>App: onSearchClick()
        App->>Search: 显示搜索模态框
        
        U->>Search: 输入搜索关键词
        U->>Search: 查看搜索历史/热门推荐
        U->>Search: 执行搜索
        Search->>App: 返回搜索结果
        App->>List: 展示搜索结果
    end
    
    rect rgb(255, 248, 240)
        Note over U, List: 筛选流程
        U->>Header: 点击筛选按钮
        Header->>App: onFilterClick()
        App->>Filter: 显示筛选抽屉
        
        U->>Filter: 选择年级/学科/难度/类型
        U->>Filter: 点击"确认"
        Filter->>App: onConfirm(tags, grade, subject)
        App->>App: 更新筛选状态
        App->>List: 按条件过滤内容
    end
```

---

## 5. 用户中心流程

```mermaid
sequenceDiagram
    participant U as 用户
    participant Header as PlazaHeader
    participant Profile as ProfilePage
    participant Message as MessageCenter
    participant Detail as 详情页面
    participant App as App.tsx

    U->>Header: 点击头像
    Header->>App: onProfileClick()
    App->>Profile: 显示个人资料页
    
    Profile->>Profile: 加载用户信息(头像/用户名/统计)
    Profile->>Profile: 加载标签页内容(笔记/收藏/赞过/草稿)
    
    alt 查看消息
        U->>Profile: 点击铃铛图标
        Profile->>App: onMessageClick()
        App->>Message: 显示消息中心
        
        U->>Message: 点击消息项
        Message->>App: onMessageClick(message)
        App->>App: 根据消息类型跳转
        alt 跳转到帖子
            App->>Detail: 显示帖子详情
        else 跳转到用户主页
            App->>Profile: 显示他人主页
        end
    end
    
    alt 编辑个人信息
        U->>Profile: 点击编辑头像/用户名/签名
        Profile->>Profile: 进入编辑模式
        U->>Profile: 修改内容
        Profile->>Profile: 保存更改
    end
    
    alt 管理帖子
        U->>Profile: 点击"笔记"标签下的帖子
        Profile->>App: onPostClick(postId)
        App->>Detail: 显示帖子详情
        
        U->>Profile: 点击更多操作
        Profile->>Profile: 显示操作抽屉(编辑/分享/删除)
    end
```

---

## 6. 内容详情交互流程

```mermaid
sequenceDiagram
    participant U as 用户
    participant Detail as 详情页面
    participant FileList as FileListPage
    participant Other as 他人主页
    participant App as App.tsx

    U->>Detail: 进入内容详情页
    Detail->>Detail: 渲染内容(封面/标题/作者/标签/描述)
    
    rect rgb(240, 255, 240)
        Note over U, App: 社交互动
        U->>Detail: 点击点赞按钮
        Detail->>Detail: 切换点赞状态 & 更新计数
        
        U->>Detail: 点击收藏按钮
        Detail->>Detail: 切换收藏状态
        
        U->>Detail: 输入评论并提交
        Detail->>Detail: 添加评论到列表
    end
    
    rect rgb(255, 240, 240)
        Note over U, App: 作者相关(非自己的帖子)
        U->>Detail: 点击作者头像
        Detail->>App: onAvatarClick(authorId, name, avatar)
        App->>Other: 显示他人主页
        
        U->>Detail: 点击"关注"按钮
        Detail->>Detail: 切换关注状态
    end
    
    rect rgb(240, 240, 255)
        Note over U, App: 自己的帖子操作
        U->>Detail: 点击更多操作按钮
        Detail->>Detail: 显示操作菜单
        
        alt 编辑
            U->>Detail: 点击"编辑"
            Detail->>App: onEdit()
            App->>App: 跳转到编辑页面
        else 分享
            U->>Detail: 点击"分享"
            Detail->>App: onShare()
            App->>App: 复制链接到剪贴板
        else 删除
            U->>Detail: 点击"删除"
            Detail->>App: onDelete()
            App->>App: 确认后删除帖子
        end
    end
    
    rect rgb(255, 255, 240)
        Note over U, App: 资料特有功能
        U->>Detail: 点击"查看文件列表"
        Detail->>App: onFileListClick(files, title)
        App->>FileList: 显示文件列表页
        
        U->>FileList: 下载/预览/转存文件
        U->>FileList: 点击返回
        FileList->>App: onBack()
        App->>Detail: 返回详情页
    end
```

---

## 7. 学习集学习流程

```mermaid
sequenceDiagram
    participant U as 用户
    participant Detail as StudySetDetail
    participant Flip as FlipCard
    participant Match as MatchingGame
    participant Quiz as QuizGame

    U->>Detail: 进入学习集详情
    Detail->>Detail: 显示学习集信息 & 卡片列表
    
    alt 翻转卡片模式
        U->>Detail: 点击"翻转卡片"
        Detail->>Flip: 进入翻转学习模式
        loop 学习每张卡片
            Flip->>Flip: 显示术语(正面)
            U->>Flip: 点击卡片
            Flip->>Flip: 翻转显示定义(背面)
            U->>Flip: 左右滑动切换卡片
            U->>Flip: 标记"已掌握"
        end
        Flip->>Flip: 显示学习进度
    end
    
    alt 匹配游戏模式
        U->>Detail: 点击"匹配游戏"
        Detail->>Match: 进入匹配游戏模式
        Match->>Match: 打乱术语和定义
        loop 匹配所有卡片
            U->>Match: 点击术语
            U->>Match: 点击对应定义
            alt 匹配正确
                Match->>Match: 显示正确提示 ✓
                Match->>Match: 移除已匹配项
            else 匹配错误
                Match->>Match: 显示错误提示 ✗
            end
        end
        Match->>Match: 显示完成结果
    end
    
    alt 测验游戏模式
        U->>Detail: 点击"测验"
        Detail->>Quiz: 进入测验模式
        loop 答题
            Quiz->>Quiz: 显示题目(术语/定义)
            Quiz->>Quiz: 显示选项
            U->>Quiz: 选择答案
            Quiz->>Quiz: 显示正确/错误反馈
            U->>Quiz: 点击"下一题"
        end
        Quiz->>Quiz: 显示测验总结(得分/正确率)
        U->>Quiz: 重新开始/返回
    end
```

---

## 8. 名师咨询流程

```mermaid
sequenceDiagram
    participant U as 用户
    participant List as TeacherPage
    participant Detail as TeacherDetailPage
    participant Consult as ConsultationPage
    participant Companion as StudyCompanionPage
    participant App as App.tsx

    U->>List: 进入名师页面
    List->>List: 加载名师列表(mockTeachers)
    List->>List: 显示名师卡片(头像/姓名/职称/评分/价格)
    
    U->>List: 点击名师卡片
    List->>App: onTeacherClick(teacher)
    App->>Detail: 显示名师详情页
    
    Detail->>Detail: 渲染名师信息(服务标签/帮助人数/响应率)
    
    alt 咨询问题
        U->>Detail: 点击"咨询问题"
        Detail->>App: onConsultationClick()
        App->>Consult: 显示咨询页面
        
        U->>Consult: 输入咨询内容
        U->>Consult: 点击发送/支付
        Consult->>App: onPayment()
        Note right of App: 处理支付: consultationPrice
    end
    
    alt 规划伴学
        U->>Detail: 点击"规划伴学"
        Detail->>App: onCompanionClick()
        App->>Companion: 显示伴学页面
        
        U->>Companion: 查看伴学计划
        U->>Companion: 点击购买/支付
        Companion->>App: onPayment()
        Note right of App: 处理支付: companionPrice
    end
    
    U->>Detail: 点击返回
    Detail->>App: onBack()
    App->>App: setSelectedTeacher(null)
```

---

## 9. 状态管理流程

```mermaid
flowchart LR
    subgraph 核心状态
        A[contents<br/>内容列表]
        B[currentTab<br/>当前标签页]
        C[currentSubTab<br/>子标签页]
    end
    
    subgraph 选中状态
        D[selectedMaterial<br/>选中的资料]
        E[selectedQuestion<br/>选中的问答]
        F[selectedStudySet<br/>选中的学习集]
        G[selectedTeacher<br/>选中的名师]
    end
    
    subgraph 页面显示状态
        H[showProfilePage<br/>个人资料页]
        I[showMessageCenter<br/>消息中心]
        J[showSearchModal<br/>搜索模态框]
        K[showFilterDrawer<br/>筛选抽屉]
    end
    
    subgraph 发帖流程状态
        L[showPostActionSheet<br/>发帖抽屉]
        M[showWriteIdeaPage<br/>写想法页面]
        N[showSelectIllustrationPage<br/>选择配图]
        O[showEditPostPage<br/>编辑帖子]
        P[postText<br/>帖子文本]
    end
    
    subgraph 创建模态框状态
        Q[showCreateMaterialModal<br/>创建资料]
        R[showCreateStudySetModal<br/>创建学习集]
        S[showQuestionModal<br/>提问模态框]
    end
    
    subgraph 筛选状态
        T[selectedTags<br/>选中标签]
        U[selectedGrade<br/>选中年级]
        V[selectedSubject<br/>选中学科]
    end
    
    A --> D & E & F
    B --> A
    L --> M --> N --> O
    P --> O
```

---

## 10. 组件依赖关系

```mermaid
flowchart TB
    App[App.tsx<br/>主应用入口]
    
    subgraph 数据层
        Mock[mockData.ts<br/>模拟数据]
        Types[types/index.ts<br/>类型定义]
    end
    
    subgraph 页面组件
        Plaza[PlazaHeader<br/>广场头部]
        Material[MaterialPage<br/>资料页面]
        QA[QAPage<br/>答疑页面]
        StudySet[StudySetPage<br/>学习集页面]
        Teacher[TeacherPage<br/>名师页面]
    end
    
    subgraph 详情组件
        MaterialDetail[MaterialDetail]
        QuestionDetail[QuestionDetail]
        StudySetDetail[StudySetDetail]
        TeacherDetail[TeacherDetailPage]
    end
    
    subgraph 用户组件
        Profile[ProfilePage]
        Message[MessageCenter]
    end
    
    subgraph 创建组件
        PostSheet[PostActionSheet]
        WriteIdea[WriteIdeaPage]
        SelectIllust[SelectIllustrationPage]
        EditPost[EditPostPage]
        CreateMaterial[CreateMaterialModal]
        CreateStudySet[CreateStudySetModal]
        QuestionModal[QuestionModal]
    end
    
    subgraph 功能组件
        Search[SearchModal]
        Filter[FilterDrawer]
        FileList[FileListPage]
    end
    
    subgraph 学习组件
        FlipCard[FlipCard]
        MatchGame[MatchingGame]
        QuizGame[QuizGame]
    end
    
    subgraph 卡片组件
        PlazaCard[PlazaContentCard]
        MaterialCard[MaterialCard]
        StudySetCard[StudySetCard]
        QuestionCard[QuestionCard]
        TeacherCard[TeacherConsultationCard]
    end
    
    App --> Mock & Types
    App --> Plaza & Material & QA & StudySet & Teacher
    App --> MaterialDetail & QuestionDetail & StudySetDetail & TeacherDetail
    App --> Profile & Message
    App --> PostSheet --> WriteIdea --> SelectIllust --> EditPost
    App --> CreateMaterial & CreateStudySet & QuestionModal
    App --> Search & Filter & FileList
    
    StudySetDetail --> FlipCard & MatchGame & QuizGame
    
    Plaza --> PlazaCard
    Material --> MaterialCard
    StudySet --> StudySetCard
    QA --> QuestionCard
    Teacher --> TeacherCard
```

---

## 图例说明

| 符号 | 含义 |
|------|------|
| `participant` | 参与者/组件 |
| `-->` / `->>` | 同步调用 |
| `-->>` | 返回/响应 |
| `alt` | 条件分支 |
| `loop` | 循环 |
| `rect` | 分组/区域 |
| `Note` | 注释说明 |

---

## 技术栈

- **前端框架**: React 18 + TypeScript
- **构建工具**: Vite
- **样式方案**: Tailwind CSS
- **图标库**: Lucide React
- **状态管理**: React useState Hooks









